<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Goaccess</title>
    <link href="" rel="alternate" title="⋲ᴹ∧cₛ ℜø∁κ§" type="application/atom+xml">
    <style> :root {

    --BGC      : #000000;
    --FGC      : #ffffff;
    --BGClogo  : #222222;
    --FGClogo  : #ffffff;
    --FGCtitle  : #ffffff;  /* #+TITLE:      */
    --FGCstart1 : #4B99D2;  /* *             */
    --FGCstart2 : #98fb98;  /* **            */
    --FGCstart3 : #dd2300;  /* ***           */
    --FGCstart4 : #b0c4de;  /* ****          */
    --FGCstart5 : #7fffd4;  /* *****         */
    --FGCstart6 : #00dddd;  /* ******        */
    --FGCstart7 : #db2e24;  /* *******       */
    --FGCstart8 : #ff4500;  /* ********      */
    --FGCtext  : #ffffff;
    --FGCemph  : #ffffff;
    --FGCbtcode: #333333;
    --FGCftcode: #ffffff;
    --FGCbcode : #b3b3b3;
    --FGCtcomm : #ff4500;
    --FGCtcode : #bfbfff;
    --FGCfile  : #eedd82;
    --FGCmath  : #98fb98;
    --FGClink  : #00ffff;
    --BGClinkh : #556b2f;
    --FGClinkh : #ffffff;
    --BGCdt    : #b3b3b3;
    --FGCdt    : #ffffff;
    --FGCthead : #ff7f24;
    --BGCthead : #000000;
    --FGCtbody : #87cefa;
}

@font-face { font-family: text;           src: local('sans-serif'          );                     }
@font-face { font-family: text_bold;      src: local('sans-serif'   ); font-style: bold;   }
@font-face { font-family: text_italic;    src: local('sans-serif'   ); font-style: italic; }
@font-face { font-family: text_verse;     src: local('sans-serif'   ); font-style: italic; }
@font-face { font-family: title;          src: local('cursive'      );                     }
@font-face { font-family: heatline;       src: local('cursive'      );                     }
@font-face { font-family: codetext;       src: url('https://nasciiboy.github.io/DejaVuSansMono.ttf'); }
@font-face { font-family: codeblock;      src: url('https://nasciiboy.github.io/DejaVuSansMono.ttf'); }
@font-face { font-family: description_dt; src: local('cursive'      );                     }
@font-face { font-family: description_dd; src: local('sans'         );                     }

html { background: var( --BGC ); color: var( --FGC );
       margin: 0; padding: 0;
       font-size: 1.3em;
       line-height: 1.5em;
       box-sizing: border-box;
     }

html body { margin: 1em 0em 1em 1em;
            font-size: 1.0em;
            font-family: text;
          }

html body main {font-size: 1.0em;
                font-family: text;
                box-sizing:border-box;
                padding: 1em 1em 1em 1.5em
                ;
                width: 80%;
                float: left;
               }

html body main article { padding-right: 1em; }

html body main div.thumb {font-size: 1.0em;
                font-family: text;
                box-sizing: border-box;
                padding: 1em;
                width: 48%;
                float: left;
               }

ul.article { list-style: none; line-height: 1em; padding-top: .5em; }

h1 { font-size: 1.8em; font-family:    title; } /* *        */
h2 { font-size: 1.7em; font-family: heatline; } /* **       */
h3 { font-size: 1.6em; font-family: heatline; } /* ***      */
h4 { font-size: 1.5em; font-family: heatline; } /* ****     */
h5 { font-size: 1.5em; font-family: heatline; } /* *****    */
h6 { font-size: 1.5em; font-family: heatline; } /* ******   */
h7 { font-size: 1.5em; font-family: heatline; } /* *******  */
h8 { font-size: 1.5em; font-family: heatline; } /* ******** */

h2 { text-align: center; color: var( --FGCstart1 ); }
h3 { text-align: center; color: var( --FGCstart2 ); }
h4 { text-align: center; color: var( --FGCstart3 ); }
h5 { text-align: center; color: var( --FGCstart4 ); }
h6 { text-align: center; color: var( --FGCstart5 ); }
h7 { text-align: center; color: var( --FGCstart6 ); }
h8 { text-align: center; color: var( --FGCstart7 ); }
h9 { text-align: center; color: var( --FGCstart8 ); }

h2::before { content: "卐 ";                       }
h3::before { content: "卍卍 ";                      }
h4::before { content: "卐卐卐 ";                     }
h5::before { content: "卍卍卍卍 ";                    }
h6::before { content: "卐卐卐卐卐 ";                   }
h7::before { content: "卍卍卍卍卍卍 ";                  }
h8::before { content: "卐卐卐卐卐卐卐 ";                 }
h9::before { content: "卍卍卍卍卍卍卍卍 ";                }

h1 { line-height: 1.5em; text-align: center; }

ul.meta { list-style: none; padding-left: 0.8em; margin: 0em; }
ul.meta li { line-height: 1.5em; }

.taxonomies { color: green; clear: both; }

.summary {
  max-height: 8.7rem;
  overflow: hidden;
}

div.thumb-sm {font-size: 0.7em;
                font-family: text;
             }

.thumb-sm header h2 { margin: 0em; padding: 0.3em 0em 0em 0em; }

html body aside {
    font-size: 1.0em;
    font-family: text;
    box-sizing:border-box;
    width: 20%;
    float: left;
    padding-left: 1em;
}

header.key { color: black; }

aside div ul { padding-left: 0em; margin: 0em; }

html body footer {
    font-size: 0.7em;
    clear: both;
}

nav.p-paging { clear: both; padding-top: 2em; text-align: center; }

.footer-title { clear: both; }

.footer-title a { list-style: none; text-decoration: none; color: red; }

.path li { display: inline; list-style:none; padding: 0em 0.1em; margin:0em; }
.path li a { text-decoration: none; color: #87cefa; }
.path-pwd { color: yellow; }

pre {
    background-color: var( --FGCbtcode ); color: white;
    font-size: 1em; text-align: left; font-family: codeblock;
    box-sizing:border-box; padding: 1.0em; border: 0.05em solid #ddd;
    overflow: auto;
}

pre code { background-color: var( --FGCbtcode );
           color: var( --FGCftcode );
           font-size: 1em;  font-family: codetext;
           padding: 0em;
}

ul.nav { list-style-type: none; }
ul.nav li { display: inline-block; list-style: none; }
ul.nav li a { color: white; background-color: black; text-decoration: none; padding: 0.5em .5em; border: 3px solid white; }
ul.nav li a:hover { color: #ea316e; background-color: white; text-decoration: none; padding: 0.2em .5em; border-radius: 1em; }


b    { font-family: text_bold; }
i    { font-family: text_italic; }
u    { text-decoration: underline; }
em   { color: var( --FGCemph ); font-weight: 600; }
code { color: var( --FGCtcode ); font-family: codetext; padding: 0px 0.2em; }
code.command { color: var( --FGCtcomm ); font-family: codetext; padding: 0px 0.2em; }
.file { color: var( --FGCfile ); font-family: codetext; }
.math { color: var( --FGCmath ); font-family: codetext; }
blockquote { font-family: text_verse; color: #bbddbb; font-style: italic; }
blockquote blockquote { font-family: text_verse; color: #aabbdd; font-style: italic; }

a { color: #00ffff; text-decoration: underline; }
a:hover { background-color: #556b2f; color: #ffffff; text-decoration: none; }

li { color: #fff; font-size: 1em; }
li b { font-weight: bold; }
li p { color: #fff; font-size: 1em; }


dl { padding-bottom: 2em; }
dl dt { color: #daa520;
                                  font-size: 1.2em; font-family: description_dt;
                                  margin-left: 0.6em; }
dd { color: #ffffff;
                                  font-size: 1.0em; font-family: description_dd; font-style: bold;
                                  margin-left: 0.6em; }
img { border: none; max-width: 100%;
    }
img:hover { border: 0.05em solid #fff; }

.separador { padding: 2em; }
.banner { padding: 0em .5em;
          clear: both;
          margin: 0em;
          width: 90%;
          display: flex;
          justify-content: center;
        }
.clear  { clear: both; }
.center { display: flex;
          justify-content: center;
        }
.previous { float: left; }
.next { float: right; }

/* #### Dark Matter #### */
.dark-matter {
    margin-left: auto;
    margin-right: auto;
    font: .3em "Helvetica Neue", Helvetica, Arial, sans-serif;
    border: none;
}
.dark-matter h1 {
    display: block;
    border-bottom: 1px solid #444;
    padding: 1em;
}
.dark-matter h1>span {
    display: block;
    font-size: .7em;
}
.dark-matter label {
    display: block;
}
.dark-matter label>span {
    float: left;
    width: 15%;
    text-align: right;
    padding-right: 2em;
    margin-top: 1.5em;
    font-weight: bold;
}
.dark-matter input[type="text"],
.dark-matter input[type="email"],
.dark-matter textarea {
    border: none;
    color: #525252;
    margin: .5em;
    padding:.3em;
    width: 70%;
    background: #DFDFDF;
}

.submit {
    background: #222;
    color: white;
    margin-top: .7em;
    padding: .5em 1.5em;
}

.submit:hover {
    color: green;
}

/* ==fanciCode== pygments compatible */
.hll { background-color: #ffffcc }
.c { color: #99968b; font-style: italic} /* Comment */
.err { color: #f6f3e8} /* Error */
.g { color: #f6f3e8} /* Generic */
.k { color: #8ac6f2} /* Keyword */
.l { color: #f6f3e8} /* Literal */
.n { color: #f6f3e8} /* Name */
.o { color: #f6f3e8} /* Operator */
.x { color: #f6f3e8} /* Other */
.p { color: #f6f3e8} /* Punctuation */
.cm { color: #99968b; font-style: italic} /* Comment.Multiline */
.cp { color: #e5786d} /* Comment.Preproc */
.c1 { color: #99968b; font-style: italic} /* Comment.Single */
.cs { color: #99968b; font-style: italic} /* Comment.Special */
.gd { color: #f6f3e8} /* Generic.Deleted */
.ge { color: #f6f3e8} /* Generic.Emph */
.gr { color: #f6f3e8} /* Generic.Error */
.gh { color: #f6f3e8; font-weight: bold} /* Generic.Heading */
.gi { color: #f6f3e8} /* Generic.Inserted */
.go { color: #808080; background-color: #303030 } /* Generic.Output */
.gp { color: #f6f3e8} /* Generic.Prompt */
.gs { color: #f6f3e8} /* Generic.Strong */
.gu { color: #f6f3e8; font-weight: bold} /* Generic.Subheading */
.gt { color: #f6f3e8} /* Generic.Traceback */
.kc { color: #8ac6f2} /* Keyword.Constant */
.kd { color: #8ac6f2} /* Keyword.Declaration */
.kn { color: #8ac6f2} /* Keyword.Namespace */
.kp { color: #8ac6f2} /* Keyword.Pseudo */
.kr { color: #8ac6f2} /* Keyword.Reserved */
.kt { color: #cae682} /* Keyword.Type */
.ld { color: #f6f3e8} /* Literal.Date */
.m { color: #e5786d} /* Literal.Number */
.s { color: #95e454; font-style: italic} /* Literal.String */
.na { color: #cae682} /* Name.Attribute */
.nb { color: #f6f3e8} /* Name.Builtin */
.nc { color: #f6f3e8} /* Name.Class */
.no { color: #e5786d} /* Name.Constant */
.nd { color: #f6f3e8} /* Name.Decorator */
.ni { color: #e7f6da} /* Name.Entity */
.ne { color: #f6f3e8} /* Name.Exception */
.nf { color: #cae682} /* Name.Function */
.nl { color: #f6f3e8} /* Name.Label */
.nn { color: #f6f3e8} /* Name.Namespace */
.nx { color: #f6f3e8} /* Name.Other */
.py { color: #f6f3e8} /* Name.Property */
.nt { color: #8ac6f2} /* Name.Tag */
.nv { color: #cae682} /* Name.Variable */
.ow { color: #f6f3e8} /* Operator.Word */
.w { color: #f6f3e8} /* Text.Whitespace */
.mf { color: #e5786d} /* Literal.Number.Float */
.mh { color: #e5786d} /* Literal.Number.Hex */
.mi { color: #e5786d} /* Literal.Number.Integer */
.mo { color: #e5786d} /* Literal.Number.Oct */
.sb { color: #95e454; font-style: italic} /* Literal.String.Backtick */
.sc { color: #95e454; font-style: italic} /* Literal.String.Char */
.sd { color: #95e454; font-style: italic} /* Literal.String.Doc */
.s2 { color: #95e454; font-style: italic} /* Literal.String.Double */
.se { color: #95e454; font-style: italic} /* Literal.String.Escape */
.sh { color: #95e454; font-style: italic} /* Literal.String.Heredoc */
.si { color: #95e454; font-style: italic} /* Literal.String.Interpol */
.sx { color: #95e454; font-style: italic} /* Literal.String.Other */
.sr { color: #95e454; font-style: italic} /* Literal.String.Regex */
.s1 { color: #95e454; font-style: italic} /* Literal.String.Single */
.ss { color: #95e454; font-style: italic} /* Literal.String.Symbol */
.bp { color: #f6f3e8} /* Name.Builtin.Pseudo */
.vc { color: #cae682} /* Name.Variable.Class */
.vg { color: #cae682} /* Name.Variable.Global */
.vi { color: #cae682} /* Name.Variable.Instance */
.il { color: #e5786d} /* Literal.Number.Integer.Long */
</style>
  </head>
  <body>
    
<main>
  <div class="clear" ><a href="https://nasciiboy.github.io">/</a></span> <span><a href="https://nasciiboy.github.io/prog">prog</a></div>

  <h1>Goaccess</h1>
  

<p>esta &ldquo;bitacora&rdquo; no incluye galletas, ni js (de mierda) y aunque tiene
casi dos añitos de existir, hasta hace poco no tenia idea de cuantas personas (o
cosas) se pasan por aqui o para que</p>

<p>uno de los cambios que vino tras (parte de) el exilio de github fue que ahora
los logs del servidor son mios, para como todos los demas, &ldquo;recoger
estadisticas&rdquo;. Sin embargo las consultas se limitaban a ver un conteo de visitas</p>

<pre><code>&gt; cat /var/log/nginx/access.log | awk '{ print $1 }' | sort | uniq -c | sort -n | perl -lane 'print $F[1], &quot;\t&quot;, $F[0], &quot;\t&quot;, &quot;▄&quot; x ($F[0] / 15)' | awk '{ tot+=$2 }; END { print &quot;TOTAL &quot; tot }'
TOTAL 16352
</code></pre>

<p>o graficar las ip mas frecuentes</p>

<pre><code>&gt; cat /var/log/nginx/access.log | awk '{ print $1 }' | sort | uniq -c | sort -n | tail | perl -lane 'print $F[1], &quot;\t&quot;, $F[0], &quot;\t&quot;, &quot;▄&quot; x ($F[0] / 20)'
188.40.107.254  228     ▄▄▄▄▄▄▄▄▄▄
192.3.177.102   231     ▄▄▄▄▄▄▄▄▄▄
23.237.4.26     301     ▄▄▄▄▄▄▄▄▄▄▄▄▄▄
92.185.168.114  315     ▄▄▄▄▄▄▄▄▄▄▄▄▄▄
5.45.207.58     346     ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
78.46.161.81    355     ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
216.244.66.228  693     ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
94.130.18.77    697     ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
104.248.193.105 724     ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
187.225.125.52  1234    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
</code></pre>

<p>hasta que una nueva busqueda llevo a conocer un programito que puede hacer mas
cosas con los logs de acceso de nginx (de apache y otros). No solo eso, ademas
viene en los repositorios de debian 9, esta escrito en C, no requiere procesos en
segundo plano, demonios, js o ninguna mierda extrabagante y nos hara sentir
mejor persona</p>

<pre><code>&gt; apt install goaccess
</code></pre>

<p>si lo lanzamos de la siguiente manera</p>

<pre><code>&gt; goaccess -f /var/log/nginx/access.log
</code></pre>

<p>se abrira un menu para indicar el formato de log, fecha y tiempo que vamos a
utilizar, porque, aunque el programa sea eficaz, no es magico</p>

<p><img src="https://nasciiboy.github.io/img/goaccess/goaccess-00.png" alt="" /></p>

<p>basta con presionar <code>Espacio</code> en una de las opciones y lugo dar un <code>Enter</code></p>

<p><img src="https://nasciiboy.github.io/img/goaccess/goaccess-01.png" alt="" /></p>

<p>Si la opcion que hemos elegido no es valida para el log, nos lo informara y
podremos probar otra hasta que funcione</p>

<p><img src="https://nasciiboy.github.io/img/goaccess/goaccess-02.png" alt="" /></p>

<p>con la informacion de esta pantalla, mas tarde podriamos configurar el programa
para ingresar directamente en la interfaz de texto. Dentro de las opcciones que
he podido probar y funcionan para mi servidor (nginx) con una sola pagina sin
&ldquo;Virtual Host&rdquo;</p>

<ul>
<li>NCSA Combined Log Format</li>
<li>Common Log Format (CLF)</li>
</ul>

<p>las opcciones que son invalidas</p>

<ul>
<li>NCSA Combined Log Format with Virtual Host</li>
<li>Common Log Format (CLF) with Virtual Host</li>
<li>W3C</li>
<li>CloudFront (Download Distribution)</li>
</ul>

<p>con estos datos ya podemos acceder a la configuracion</p>

<pre><code>&gt; emacs /etc/goaccess.conf
</code></pre>

<p>y descomentar las siguientes lineas</p>

<pre><code>...
time-format %H:%M:%S
...
date-format %d/%b/%Y
...
# NCSA Combined Log Format
#
log-format %h %^[%d:%t %^] &quot;%r&quot; %s %b &quot;%R&quot; &quot;%u&quot;
...
</code></pre>

<p>tras esto, ejecutando de nuevo</p>

<pre><code>&gt; goaccess -f /var/log/nginx/access.log
</code></pre>

<p>entrariamos directamente en la interfaz de texto (<code>q</code> para salir)</p>

<p><img src="https://nasciiboy.github.io/img/goaccess/goaccess-03.png" alt="" /></p>

<p>podriamos ademas indicar cual es exactamente el fichero que vamos a utilizar
como datos de entrada</p>

<pre><code># Specify the path to the input log file. If set, it will take
# priority over -f from the command line.
#
#log-file /var/log/apache2/access.log
log-file /var/log/nginx/access.log
</code></pre>

<p>de esta manera solo bastaria ejecutar <code>goaccess</code> sin ningun argumento extra.
Pero y basado en mis pruebas, algunos parametros de linea de comandos, cuando se
establecen en la configuracion (como <code>log-file</code> o <code>log-format</code>) parecen ser
totalmente ignorados si se utiliza <code>goaccess</code> luego de una tuberia. Me explico,
si tras la configuracion lanzamos</p>

<pre><code>&gt; goaccess -f /var/log/nginx/access.log -c
</code></pre>

<p>nos permite cambiar el fichero de entrada, tambien modificar el formato de log,
fecha y hora. Sin embargo, utilizado en una tuberia</p>

<pre><code>&gt; zcat -f /var/log/nginx/access.log* | goaccess -c
</code></pre>

<p><code>goaccess</code> se pasara por el forro los datos de la tuberia y tambien los parametros que
agreguemos (<code>-c</code>). Solamente hace caso del contenido en su fichero de configuracion. Por
esta razon, para hacer una metrica de un &ldquo;bulto de logs&rdquo; (como en el comando
anterior) o de logs distintos, recomiendo no configurar <code>log-file</code></p>

<p>adicionalmente he incluido las siguientes lineas para indicar que algunas
extensiones se consideren como ficheros estaticos</p>

<pre><code>static-file .mkv
static-file .webm
static-file .mp4
static-file .xz
static-file .zip
</code></pre>

<p>veamos ahora el uso de este programito, haciendo un</p>

<pre><code>&gt; zcat -f /var/log/nginx/access.log* | goaccess
</code></pre>

<p><img src="https://nasciiboy.github.io/img/goaccess/goaccess-04.png" alt="" /></p>

<p>veremos que tiene unos datos principales (como peticiones totales, visitantes
unicos, ficheros estaticos, etc) y (moviendo las frechas arriba y abajo) las
&ldquo;secciones&rdquo;</p>

<ul>
<li><code>1 - Unique visitors per day - Including spiders</code></li>
<li><code>2 - Top requests (URLs)</code></li>
<li><code>3 - Top static requests (e.g. jpg, png, js, css</code></li>
<li><code>4 - HTTP 404 Not Found URLs</code></li>
<li><code>5 - Visitor hostnames and IPs</code></li>
<li><code>6 - Operating Systems</code></li>
<li><code>7 - Browsers</code></li>
<li><code>8 - Time Distribution</code></li>
<li><code>10 - Referring Sites</code></li>
<li><code>12 - Geo Location</code></li>
<li><code>13 - HTTP Status Codes</code></li>
</ul>

<p>de las cuales una es la seccion &ldquo;activa&rdquo;. Esto se indica ademas de por un
resaltado, por iniciar con el signo <code>&gt;</code>.</p>

<p>Para entrar en dicha seccion, presionamos bien <code>Espacio</code>, o bien <code>Enter</code></p>

<p><img src="https://nasciiboy.github.io/img/goaccess/goaccess-05.png" alt="" /></p>

<p>ya dentro, podemos movernos por &ldquo;las filas&rdquo; mediante <code>j</code> (abajo) y <code>k</code> (arriba),
<code>g</code> inicio y <code>G</code> fin. Tambien, (de una manera un poco rara) ajustar lo que
aparece en pantalla con arriba y abajo</p>

<p>para salir de &ldquo;la seccion&rdquo; precionamos <code>q</code>. Para saltar a la siguiente seccion
<code>TAB</code> para saltar a la seccion anterior <code>Shift-TAB</code> y para ir a una seccion
especifica mediante su numero del 1-9. (No me pregunten como ir a la seccion 1X). Para
saltar a la ultima seccion <code>G</code> y a la primera <code>g</code>.</p>

<p>podemos alterar el tema de colores con <code>c</code></p>

<p><img src="https://nasciiboy.github.io/img/goaccess/goaccess-06.png" alt="" /></p>

<p>y ver el resto de la ayuda con <code>F1</code> o <code>h</code></p>

<p><img src="https://nasciiboy.github.io/img/goaccess/goaccess-07.png" alt="" /></p>

<p>otra manera menos &ldquo;rudimentaria&rdquo; de ver las metricas seria crear un fichero
html, Waaalaa!</p>

<p><img src="https://nasciiboy.github.io/img/goaccess/goaccess-08.png" alt="" /></p>

<p>Para eso, solamente es necesario rediriguir la salida de la
siguiente forma</p>

<pre><code>&gt; zcat -f /var/log/nginx/access.log* | goaccess &gt; mis-metricas.html
</code></pre>

<p>en la <a href="https://goaccess.io/faq">documentacion</a> mencionan un parametro para hacer
que las metricas en formato web funcionen en tiempo real</p>

<pre><code>&gt; goaccess /var/log/nginx/access.log -o /var/www/html/report.html --real-time-html
</code></pre>

<p>aunque en la vercion incluida en debian, dicho parametro no esta disponible. Por lo demas,
consultar la pagina <a href="https://goaccess.io/get-started">web del proyecto</a>, su man
y darles ★★★★★ en <a href="https://github.com/allinurl/goaccess/">github</a></p>

<p>&hellip;.</p>

<p>tras &ldquo;un buen&rdquo; uso de <code>goacces</code> sin necesitar de un reemplazo a la herramienta,
(pero no por ello ignorar &ldquo;lo torpe&rdquo; de la interfaz de linea de comandos),
encontre que se puede filtrar el rango de dias a consultar utilizando (como no)
las tipicas herramientas de &ldquo;la filosofia unix&rdquo;.</p>

<p>Para ello dos sencillos ejemplos. Primero consultar el dia actual</p>

<pre><code># en bash
&gt; zcat -f /var/log/nginx/access.log* | grep -i $(date '+%d/%b/%Y') | goaccess

# en fish
&gt; zcat -f /var/log/nginx/access.log* | grep -i (date '+%d/%b/%Y') | goaccess
</code></pre>

<p>y (simplificando lo anterior) consultar las visitas del ultimo mes</p>

<pre><code>&gt; zcat -f /var/log/nginx/access.log* | grep -i $(date '+/%b/%Y') | goaccess
</code></pre>

<p>tambien, pero esta vez con <code>fish</code> consultar las visitas de hoy y ayer</p>

<pre><code># en fish
&gt; zcat -f /var/log/nginx/access.log* | awk (printf &quot;/%s/; /%s/&quot; (date -d &quot;yesterday&quot; '+%d\\/%b\\/%Y') (date '+%d\\/%b\\/%Y')) | goaccess
</code></pre>

<h2 id="logrotate">logrotate</h2>

<p>y ahora veamos que con el buen log de nginx.</p>

<p>en debian cuando instalamos nginx desde los repos, misteriozamente comienzan a
brotar ficheros <code>access.log.1</code>, <code>access.log.2</code>, <code>access.log.3</code>, …, a razon de
uno por dia. Este comportamiento se debe a un programa que corre una vez por dia
de nombre <code>logrotate</code>, que rota los ficheros <code>access</code> y <code>error</code> todos los
dias&hellip;  bien podria considerarse una copia de seguridad de los sucesos del
servidor, o bien una molestia innecesaria, segun cada quien.</p>

<p>En un post de <a href="https://www.linuxito.com/gnu-linux/nivel-medio/927-como-instalar-logrotate-y-configurar-la-rotacion-de-logs-de-nginx">linuxito</a>
el nos comentaba como instalar y configurar <code>logrotate</code>, pero como ya en debian
funciona por defecto sin que hagamos nada, me he limitado a modificar el
comportamiento, de forma que los registros roten solo una vez por mes</p>

<p>mediante nuestro editor faborito</p>

<pre><code>&gt; emacs /etc/logrotate.d/nginx
</code></pre>

<p>aparece lo siguiente</p>

<pre><code>/var/log/nginx/*.log {
        daily
        missingok
        rotate 14
        compress
        delaycompress
        notifempty
        create 0640 www-data adm
        sharedscripts
        prerotate
                if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
                        run-parts /etc/logrotate.d/httpd-prerotate; \
                fi \
        endscript
        postrotate
                invoke-rc.d nginx rotate &gt;/dev/null 2&gt;&amp;1
        endscript
}
</code></pre>

<p>lo he dejado asi</p>

<pre><code>/var/log/nginx/*.log {
	monthly
	missingok
	rotate 14
	compress
	notifempty
	create 0640 www-data adm
	sharedscripts
	prerotate
		if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
			run-parts /etc/logrotate.d/httpd-prerotate; \
		fi \
	endscript
	postrotate
		invoke-rc.d nginx rotate &gt;/dev/null 2&gt;&amp;1
	endscript
}
</code></pre>

<h2 id="nascii-results">nascii-results</h2>

<p>y bueno, ya que estoy por que no hacer un analisis de los logs y obtener
informacion que no influira de ninguna manera el futuro de este diario&hellip; amenos
no de momento y solo contemplando la posivilidad de colocar anuncios
de hardware y de porno. A todo mundo le gusta el porno y el harware, no?</p>

<p>si quieren acompañarme con sus propias deducciones coloco el resultado
<a href="http://nasciiboy.github.io/goaccess.html">aqui</a></p>

<p>El servidor inicio con los resgistros hace 17 dias con un total de 17XXX
visitas, que serian una media aproximada de 1k por dia y segun la seccion
<strong>Browsers</strong> el 27% se identifica con el genero no binario grissexual
<em>Crawlers</em>. Otro buen habido 26% son firefoxxexual y el resto, las minorias
oprimidas que no importan. 47% prefiere no informar que OS utiliza, 23% procede
de las ventanas y los demas votan como Unix Like</p>

<p>aunque el sitio no esta contemplado para verse desde un movil</p>

<p><img src="https://nasciiboy.github.io/img/goaccess/movil.png" alt="" /></p>

<p>casi un 5% lo hace asi. Puede que no incluya mierdas web, pero las imagenes si
las incluyo en sus resoluciones originales y aveces en png! Mmm, si se
preguntaban yo la veo asi en el navegador</p>

<p><img src="https://nasciiboy.github.io/img/goaccess/web.png" alt="" /></p>

<p>La hora preferida por los huespedes son las 05. El trafico en su mayoria
proviene de</p>

<ul>
<li>40% USA</li>
<li>10% Mexico</li>
<li>26% de europa, con un atemorizante 9% de alemania (que buscaran?)
y otro razonable 5% de Espania</li>
<li>14% de asia</li>
<li>4% de america del sur</li>
<li>1% de africa</li>
</ul>

<p>la mayoria de trafico se genera internamente (8%) una vez que vienen al sitio y
el resto esta lidereado por planet.emacs-es.org, mi anterior blog en
github-pages cuyo contenido apunta aca, unas pocas busquedas en google, bing,
duckduck y alguna que otra de redit y &ldquo;sitios raros&rdquo;.</p>

<p>La mayoria solo ve la pagina de inicio. Otros tantos se sienten atraidos por las
cosas de emacs y/o su curiosadad por los titulos compactos y poco intiutivos
puede haceles creer que estan escritos en english.  Tambien hay numerosas
consultas al servidor por cosas que terminan en <code>.php</code></p>

<p>una ves dentro del sitio, poco interesa por que no todos las entradas tienen
trafico (o por que ya son habituales del sitio que consultan la novedad). Las
novedades rondan 30 visitas, siendo lo mas consultado el feed (imagino que
por mi mismo)</p>

<p>En resumen, deberia hacer caso a los crawlers y poner cosas en php!</p>


  <div class="clear" class="center">
    
    <a class="previous" href="https://nasciiboy.github.io/prog/morgue/">◀ morgue</a>
    
    
    <a class="next" href="https://nasciiboy.github.io/prog/oxido/"> Oxido ▶</a>
    
  </div>


  <div class="clear" ><a href="https://nasciiboy.github.io">/</a></span> <span><a href="https://nasciiboy.github.io/prog">prog</a></div>
</main>

    <aside>
      <div class="banner" >
      <a href="https://fsforce.noblogs.org/">
        <p style="font-size: .9em; font-weight: 800; color: white;">Apoya a RMS<p/>
      </a>
      </div>
      <div class="banner" >
      <a href="https://www.gnome.org/"> <img src="https://nasciiboy.github.io/banner/friends-of-gnome.png" alt="Become a Friend of GNOME" border="0" /></a>
      </div>
      <div class="banner" >
      <a href="https://www.debian.org/"><img src="https://nasciiboy.github.io/banner/nascii_mod-debian-logo.png" alt="Debian The universal operating system" border="0" /></a>
      </div>
      <div class="banner" >
      <a href="https://www.fsf.org/"   ><img src="https://nasciiboy.github.io/banner/behroze-gnu-button1.png" alt="Join FSF now" border="0" /></a>
      </div>
      <div class="banner" >
      <img src="https://nasciiboy.github.io/banner/RAmen.png" alt="RAmen" border="0" />
      </div>
      <div class="banner" >
      <a href="https://youtu.be/esRzKRWzhq4"><img src="https://nasciiboy.github.io/banner/sfm.png" alt="+espacios inseguros" border="0" /></a>
      </div>

      
      <section class="sidebar">
        <header class="key"><b>CATEGORIES</b></header>
        <div>
          <ul class="terms">
            <li><a href="https://nasciiboy.github.io/categories/post">post(72)</a></li><li><a href="https://nasciiboy.github.io/categories/prog">prog(59)</a></li><li><a href="https://nasciiboy.github.io/categories/love2d">love2d(36)</a></li><li><a href="https://nasciiboy.github.io/categories/emacs">emacs(16)</a></li><li><a href="https://nasciiboy.github.io/categories/vg">vg(12)</a></li><li><a href="https://nasciiboy.github.io/categories/apt">apt(5)</a></li><li><a href="https://nasciiboy.github.io/categories/">(4)</a></li>
          </ul>
        </div>
      </section>
      
      <section class="sidebar">
        <header class="key"><b>TAGS</b></header>
        <div>
          <ul class="terms">
            <li><a href="https://nasciiboy.github.io/tags/fonos">fonos(37)</a></li><li><a href="https://nasciiboy.github.io/tags/4k">4k(32)</a></li><li><a href="https://nasciiboy.github.io/tags/howto">howto(25)</a></li><li><a href="https://nasciiboy.github.io/tags/ramen">ramen(20)</a></li><li><a href="https://nasciiboy.github.io/tags/morg">morg(15)</a></li><li><a href="https://nasciiboy.github.io/tags/txt">txt(15)</a></li><li><a href="https://nasciiboy.github.io/tags/arcade">arcade(10)</a></li><li><a href="https://nasciiboy.github.io/tags/apt">apt(9)</a></li><li><a href="https://nasciiboy.github.io/tags/puzzle">puzzle(8)</a></li><li><a href="https://nasciiboy.github.io/tags/regexp">regexp(8)</a></li><li><a href="https://nasciiboy.github.io/tags/docu">docu(7)</a></li><li><a href="https://nasciiboy.github.io/tags/go">go(6)</a></li><li><a href="https://nasciiboy.github.io/tags/kameko">kameko(6)</a></li><li><a href="https://nasciiboy.github.io/tags/feminascii">feminascii(5)</a></li><li><a href="https://nasciiboy.github.io/tags/install">install(5)</a></li><li><a href="https://nasciiboy.github.io/tags/platformer">platformer(5)</a></li><li><a href="https://nasciiboy.github.io/tags/shooter">shooter(5)</a></li><li><a href="https://nasciiboy.github.io/tags/zelda">zelda(5)</a></li><li><a href="https://nasciiboy.github.io/tags/">(4)</a></li><li><a href="https://nasciiboy.github.io/tags/3ds">3ds(4)</a></li><li><a href="https://nasciiboy.github.io/tags/anime">anime(4)</a></li><li><a href="https://nasciiboy.github.io/tags/gnome">gnome(4)</a></li><li><a href="https://nasciiboy.github.io/tags/pobreotaku">pobreotaku(4)</a></li><li><a href="https://nasciiboy.github.io/tags/server">server(4)</a></li><li><a href="https://nasciiboy.github.io/tags/example">example(3)</a></li><li><a href="https://nasciiboy.github.io/tags/hardware">hardware(3)</a></li><li><a href="https://nasciiboy.github.io/tags/java">java(3)</a></li><li><a href="https://nasciiboy.github.io/tags/ncurses">ncurses(3)</a></li><li><a href="https://nasciiboy.github.io/tags/sicp">sicp(3)</a></li><li><a href="https://nasciiboy.github.io/tags/asm">asm(2)</a></li><li><a href="https://nasciiboy.github.io/tags/elisp">elisp(2)</a></li><li><a href="https://nasciiboy.github.io/tags/physics">physics(2)</a></li><li><a href="https://nasciiboy.github.io/tags/rss">rss(2)</a></li><li><a href="https://nasciiboy.github.io/tags/trl">trl(2)</a></li><li><a href="https://nasciiboy.github.io/tags/adb">adb(1)</a></li><li><a href="https://nasciiboy.github.io/tags/ag">ag(1)</a></li><li><a href="https://nasciiboy.github.io/tags/arduino">arduino(1)</a></li><li><a href="https://nasciiboy.github.io/tags/dancer">dancer(1)</a></li><li><a href="https://nasciiboy.github.io/tags/elfeed">elfeed(1)</a></li><li><a href="https://nasciiboy.github.io/tags/emu">emu(1)</a></li><li><a href="https://nasciiboy.github.io/tags/eww">eww(1)</a></li><li><a href="https://nasciiboy.github.io/tags/fastboot">fastboot(1)</a></li><li><a href="https://nasciiboy.github.io/tags/fish">fish(1)</a></li><li><a href="https://nasciiboy.github.io/tags/flac">flac(1)</a></li><li><a href="https://nasciiboy.github.io/tags/gameboy-advance">gameboy-advance(1)</a></li><li><a href="https://nasciiboy.github.io/tags/gamecube">gamecube(1)</a></li><li><a href="https://nasciiboy.github.io/tags/git">git(1)</a></li><li><a href="https://nasciiboy.github.io/tags/gourmet">gourmet(1)</a></li><li><a href="https://nasciiboy.github.io/tags/ibniz">ibniz(1)</a></li><li><a href="https://nasciiboy.github.io/tags/kde">kde(1)</a></li><li><a href="https://nasciiboy.github.io/tags/loly">loly(1)</a></li><li><a href="https://nasciiboy.github.io/tags/love2d">love2d(1)</a></li><li><a href="https://nasciiboy.github.io/tags/lxde">lxde(1)</a></li><li><a href="https://nasciiboy.github.io/tags/manga">manga(1)</a></li><li><a href="https://nasciiboy.github.io/tags/maze">maze(1)</a></li><li><a href="https://nasciiboy.github.io/tags/moc">moc(1)</a></li><li><a href="https://nasciiboy.github.io/tags/nxengine">nxengine(1)</a></li><li><a href="https://nasciiboy.github.io/tags/procedural">procedural(1)</a></li><li><a href="https://nasciiboy.github.io/tags/prog">prog(1)</a></li><li><a href="https://nasciiboy.github.io/tags/racer">racer(1)</a></li><li><a href="https://nasciiboy.github.io/tags/rms">rms(1)</a></li><li><a href="https://nasciiboy.github.io/tags/rpg">rpg(1)</a></li><li><a href="https://nasciiboy.github.io/tags/scheme">scheme(1)</a></li><li><a href="https://nasciiboy.github.io/tags/shntool">shntool(1)</a></li><li><a href="https://nasciiboy.github.io/tags/solarus">solarus(1)</a></li><li><a href="https://nasciiboy.github.io/tags/sushi">sushi(1)</a></li><li><a href="https://nasciiboy.github.io/tags/tool">tool(1)</a></li><li><a href="https://nasciiboy.github.io/tags/tower-defense">tower-defense(1)</a></li><li><a href="https://nasciiboy.github.io/tags/xxx">xxx(1)</a></li><li><a href="https://nasciiboy.github.io/tags/zero">zero(1)</a></li>
          </ul>
        </div>
      </section>
      

    </aside>
    <footer>
  <p>Licence: <em>GFDL 1.3</em>.
          Powered by <a href="https://gohugo.io/">Hugo</a>.

 Contact <a href="mailto:nasciiboy@gmail.com">nasciiboy@gmail.com</a><b>.
<b> GPG <a href="http://pgp.mit.edu/pks/lookup?op=get&amp;search=0x7A4E2DDE14D7AD94">0x7A4E2DDE14D7AD94</a><b>.
<b> Donar <a href="https://paypal.me/nasciicorp">paypal</a><b>.



</p>
</footer>

  </body>
</html>
